<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>後台｜中國內地美食美景編輯器</title>
<link rel="stylesheet" href="/style.css" />
<style>
  .wrap{max-width:1000px;margin:24px auto;padding:0 16px}
  form{display:grid;grid-template-columns:1fr 1fr;gap:12px;border:1px solid #e5e7eb;border-radius:12px;padding:12px;background:#fff}
  @media(max-width:820px){form{grid-template-columns:1fr}}
  label{font-weight:600}
  input,textarea{width:100%;padding:10px;border:1px solid #d1d5db;border-radius:8px}
  textarea{min-height:120px}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .btn{border:1px solid #d1d5db;border-radius:8px;padding:10px 12px;background:#fff;cursor:pointer}
  .primary{background:#111827;color:#fff;border-color:#111827}
  table{width:100%;border-collapse:collapse;margin-top:16px;background:#fff;border:1px solid #e5e7eb;border-radius:12px;overflow:hidden}
  th,td{border-bottom:1px solid #f1f5f9;padding:10px;text-align:left}
  .small{font-size:12px;color:#6b7280}
</style>
</head>
<body>
  <div class="compliance-links">
    <a href="/china-explore.html">← 回前台</a> |
    <a href="/index.html">Home</a> |
    <a href="/privacy.html">Privacy</a>
  </div>

  <main class="wrap">
    <h1>後台｜中國內地美食美景（本機預覽版）</h1>
    <p class="small">說明：新增內容後點「暫存到本機」即可在前台 china-explore.html 即時預覽。</p>

    <form id="f">
      <div>
        <label>標題 *</label>
        <input name="title" required placeholder="例：成都｜小郡肝串串香" />
      </div>
      <div class="row">
        <input name="city" placeholder="城市：成都" />
        <input name="province" placeholder="省份：四川" />
        <input name="kind" placeholder="類型：美食 / 美景" />
      </div>
      <div><label>標籤 *</label><input name="tags" required placeholder="例：四川,成都,串串,辣" /></div>
      <div><label>圖片網址 *</label><input name="image" placeholder="/assets/china/demo.jpg" /></div>
      <div><label>外部連結</label><input name="link" placeholder="https://..." /></div>
      <div style="grid-column:1/-1"><label>摘要</label><input name="excerpt" /></div>
      <div style="grid-column:1/-1"><label>詳細內容</label><textarea name="content"></textarea></div>
      <div class="row" style="grid-column:1/-1">
        <button type="submit" class="btn primary">加入清單</button>
        <button type="button" id="saveLocal" class="btn">暫存到本機</button>
        <button type="button" id="exportBtn" class="btn">匯出 JSON</button>
      </div>
    </form>

    <table id="tbl">
      <thead><tr><th>#</th><th>標題</th><th>城市</th><th>標籤</th><th>操作</th></tr></thead>
      <tbody></tbody>
    </table>
  </main>

  <script>
    const form = document.getElementById("f");
    const tbody = document.querySelector("#tbl tbody");
    let rows = [];

    function uid(){ return Math.random().toString(36).slice(2,10); }

    function render(){
      tbody.innerHTML = rows.map((x,i)=>`
        <tr>
          <td>${i+1}</td>
          <td>${x.title}</td>
          <td>${x.city||""}</td>
          <td class="small">${(x.tags||[]).join(", ")}</td>
          <td><button class="btn" data-del="${x.id}">刪除</button></td>
        </tr>`).join("");
    }

    form.addEventListener("submit", e=>{
      e.preventDefault();
      const d = Object.fromEntries(new FormData(form).entries());
      const item = {
        id: uid(),
        title: d.title.trim(),
        city: d.city.trim(),
        province: d.province.trim(),
        kind: d.kind.trim(),
        tags: d.tags.split(",").map(x=>x.trim()),
        image: d.image.trim(),
        link: d.link.trim(),
        excerpt: d.excerpt.trim(),
        content: d.content.trim(),
        created: new Date().toISOString().slice(0,10)
      };
      rows.unshift(item);
      render();
      form.reset();
    });

    tbody.addEventListener("click", e=>{
      const btn = e.target.closest("[data-del]");
      if(!btn) return;
      const id = btn.dataset.del;
      rows = rows.filter(r=>r.id!==id);
      render();
    });

    document.getElementById("saveLocal").onclick = ()=>{
      localStorage.setItem("china_rows", JSON.stringify(rows));
      alert("✅ 已暫存到本機（前台會自動預覽）");
    };

    document.getElementById("exportBtn").onclick = ()=>{
      const blob = new Blob([JSON.stringify(rows,null,2)], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "china.json";
      a.click();
    };

    // 初始化
    const saved = localStorage.getItem("china_rows");
    if (saved) { try { rows = JSON.parse(saved); render(); } catch {} }
  </script>
</body>
</html>
