<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ä¸­åœ‹ç¾é£Ÿç¾æ™¯åˆ†äº«ï½œChina Explore</title>
  <meta name="description" content="ä¸­åœ‹å…§åœ°æ—…è¡Œçš„ç¾é£Ÿèˆ‡ç¾æ™¯åˆ†äº«ã€‚ä¾åŸå¸‚ã€é¡åˆ¥èˆ‡æ¨™ç±¤ç€è¦½ï¼Œæ”¯æ´æœå°‹èˆ‡æ’åºï¼Œåœ–ç‰‡ä¸è£åˆ‡è‡ªé©æ‡‰é¡¯ç¤ºã€‚"/>

  <link rel="stylesheet" href="/style.css"/>

  <style>
    .page-wrap{max-width:1080px;margin:24px auto;padding:0 16px}
    .h1{font-size:28px;margin:6px 0 4px}
    .lede{color:#4b5563;margin-bottom:14px}

    /* æœ€æ–°ç¾é£Ÿåˆ†äº«ï¼ˆé¦–é æ¨¡çµ„ï¼‰ */
    .latest{margin:18px 0 8px}
    .latest h2{font-size:20px;margin:0 0 10px}
    .latest-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    @media(max-width:980px){.latest-grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:640px){.latest-grid{grid-template-columns:1fr}}
    .latest-card{border:1px solid #e5e7eb;border-radius:10px;background:#fff;overflow:hidden}
    .latest-thumb{aspect-ratio:16/10;background:#f8fafc;display:flex;align-items:center;justify-content:center}
    .latest-thumb img{width:100%;height:100%;object-fit:contain;display:block}
    .latest-body{padding:10px}
    .latest-title{font-weight:700;line-height:1.35;margin:0 0 4px;font-size:15px}
    .latest-meta{font-size:12px;color:#6b7280}

    /* å·¥å…·åˆ— */
    .toolbar{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin:16px 0 12px}
    .toolbar input[type="search"],
    .toolbar select{padding:10px 12px;border:1px solid #d1d5db;border-radius:8px}
    .toolbar input[type="search"]{flex:1;min-width:240px}

    /* æ¨™ç±¤ chips */
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0 16px}
    .chip{border:1px solid #d1d5db;border-radius:999px;padding:6px 12px;font-size:14px;
      color:#1f2937;background:#fff;cursor:pointer;user-select:none}
    .chip.active{background:#2563eb;color:#fff;border-color:#2563eb}

    /* ä¸»æ¸…å–®å¡ç‰‡ */
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    @media(max-width:980px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:640px){.grid{grid-template-columns:1fr}}
    .card{border:1px solid #e5e7eb;border-radius:12px;background:#fff;overflow:hidden;display:flex;flex-direction:column}
    .thumb{aspect-ratio:16/10;background:#f8fafc;display:flex;align-items:center;justify-content:center}
    .thumb img{width:100%;height:100%;object-fit:contain;display:block}
    .card-body{padding:12px}
    .title{font-weight:700;line-height:1.35;margin:2px 0 6px}
    .meta{font-size:12px;color:#6b7280;margin-bottom:8px}
    .badge{display:inline-block;margin-left:6px;padding:2px 8px;border-radius:999px;background:#e5f2ff;color:#2563eb;font-size:12px;border:1px solid #bfdbfe}
    .tags{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
    .tag{font-size:12px;padding:2px 8px;border-radius:999px;background:#f3f4f6;color:#374151}
    .excerpt{font-size:13px;color:#374151;margin:6px 0 0}
    .bio{margin:8px 0 0;font-size:12px;color:#6b7280}
    .actions{display:flex;gap:8px;margin-top:auto;padding:12px;border-top:1px solid #f3f4f6;background:#fafafa}
    .btn{display:inline-block;text-align:center;padding:10px 12px;border-radius:8px;border:1px solid #d1d5db;background:#fff;color:#111827}
    .btn.primary{background:#111827;color:#fff;border-color:#111827}

    /* ç©ºç‹€æ…‹ / è¼‰å…¥ */
    .empty,.loading{padding:24px;border:1px dashed #cbd5e1;border-radius:12px;color:#475569;background:#f8fafc;margin:12px 0}
  </style>

  <!-- å›ºå®šéºµåŒ…å±‘ï¼ˆé¡åˆ¥é ï¼‰ -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://todays-tasks.com/"},
      {"@type":"ListItem","position":2,"name":"China Explore","item":"https://todays-tasks.com/china-explore.html"}
    ]
  }
  </script>
</head>
<body>
  <!-- å°è¦½åˆ—ï¼ˆä¿ç•™ä½ åŸæœ‰é€£çµï¼‰ -->
  <div class="compliance-links" role="navigation" aria-label="Primary">
    <a href="/index.html">Home</a> |
    <a href="/about.html">About</a> |
    <a href="/contact.html">Contact</a> |
    <a href="/privacy.html">Privacy Policy</a> |
    <a href="/productivity-tips.html">Productivity Tips</a> |
    <a href="/article2.html">Time Management</a> |
    <a href="/article3.html">Digital To-Do Lists</a> |
    <a href="/article4.html">How to Use</a> |
    <a href="/article5.html">Weekly Review</a> |
    <a href="/etsy-guides.html">Time-Saving</a> |
    <a href="/todo.html">To Do List</a>
  </div>

  <main class="page-wrap">
    <h1 class="h1">ä¸­åœ‹ç¾é£Ÿç¾æ™¯åˆ†äº«ï¼ˆChina Exploreï¼‰</h1>
    <p class="lede">å³æ™‚å¾ Google è©¦ç®—è¡¨åŒæ­¥å…§å®¹ï¼šå¯ç”¨åŸå¸‚ã€çœä»½ã€é¡åˆ¥èˆ‡æ¨™ç±¤ç¯©é¸ï¼Œæ”¯æ´æœå°‹èˆ‡æ’åºã€‚åœ–ç‰‡ä»¥ã€Œä¸è£åˆ‡ã€æ¨¡å¼è‡ªé©æ‡‰é¡¯ç¤ºã€‚</p>

    <!-- â‘  æœ€æ–°ç¾é£Ÿåˆ†äº«æ¨¡çµ„ -->
    <section class="latest" aria-label="æœ€æ–°ç¾é£Ÿåˆ†äº«">
      <h2>ğŸœ æœ€æ–°ç¾é£Ÿåˆ†äº«</h2>
      <div id="latest" class="latest-grid"></div>
    </section>

    <!-- â‘¡ å·¥å…·åˆ—ï¼šæœå°‹ + ä¸‹æ‹‰éæ¿¾ + æ’åº -->
    <div class="toolbar" aria-label="Filters">
      <input id="q" type="search" placeholder="æœå°‹æ¨™é¡Œï¼æ‘˜è¦ï¼å…§æ–‡ï¼æ¨™ç±¤â€¦" aria-label="æœå°‹"/>
      <select id="citySel" aria-label="åŸå¸‚"><option value="">å…¨éƒ¨åŸå¸‚</option></select>
      <select id="provSel" aria-label="çœä»½"><option value="">å…¨éƒ¨çœä»½</option></select>
      <select id="kindSel" aria-label="é¡åˆ¥">
        <option value="">å…¨éƒ¨é¡åˆ¥</option>
        <option value="ç¾é£Ÿ">ç¾é£Ÿ</option>
        <option value="ç¾æ™¯">ç¾æ™¯</option>
      </select>
      <select id="sortSel" aria-label="æ’åº">
        <option value="new">æ’åºï¼šæœ€æ–°</option>
        <option value="az">æ’åºï¼šAâ†’Z</option>
      </select>
      <button id="refreshBtn" class="btn" type="button" title="é‡æ–°æŠ“å–è³‡æ–™">Refresh</button>
    </div>

    <!-- æ¨™ç±¤ chips -->
    <div id="tagChips" class="chips" aria-label="Tags å¿«é€Ÿç¯©é¸"></div>

    <!-- ä¸»æ¸…å–® -->
    <div id="status" class="loading" role="status">è¼‰å…¥ä¸­â€¦</div>
    <div id="grid" class="grid" aria-live="polite" hidden></div>
  </main>

  <footer class="footer">Â© 2025 Todayâ€™s Tasks. All rights reserved.</footer>

  <script>
    // === ä½ çš„ Google Apps Script JSON ç«¯é» ===
    const FEED_URL = "https://script.google.com/macros/s/AKfycbwq5InzCeyUnW-GHe6bNqReMQMzWvwKe_pAZpD7ONHZ4LZrBdt8lgtpdxu1c57AaPx3ww/exec";

    // DOM
    const q = document.getElementById('q');
    const citySel = document.getElementById('citySel');
    const provSel = document.getElementById('provSel');
    const kindSel = document.getElementById('kindSel');
    const sortSel = document.getElementById('sortSel');
    const refreshBtn = document.getElementById('refreshBtn');
    const tagChips = document.getElementById('tagChips');
    const statusEl = document.getElementById('status');
    const grid = document.getElementById('grid');
    const latestWrap = document.getElementById('latest');

    // ç‹€æ…‹
    let RAW = [];
    let ACTIVE_TAG = "";
    let TAGS = new Set();

    // å•Ÿå‹•
    fetchFeed();

    // äº‹ä»¶
    q.addEventListener('input', apply);
    citySel.addEventListener('change', apply);
    provSel.addEventListener('change', apply);
    kindSel.addEventListener('change', apply);
    sortSel.addEventListener('change', apply);
    refreshBtn.addEventListener('click', ()=>fetchFeed(true));

    // è®€å–è³‡æ–™
    async function fetchFeed(noCache=false){
      try{
        statusEl.hidden = false;
        statusEl.textContent = "è¼‰å…¥ä¸­â€¦";
        grid.hidden = true;

        const url = noCache ? FEED_URL + (FEED_URL.includes('?')?'&':'?') + 't=' + Date.now() : FEED_URL;
        const res = await fetch(url, {cache: noCache ? 'no-store' : 'default'});
        if(!res.ok) throw new Error('HTTP ' + res.status);
        const json = await res.json();

        RAW = Array.isArray(json.items)? json.items : [];
        normalize(RAW);
        buildFacetOptions(RAW);
        buildTagChips(RAW);
        renderLatest(RAW);
        injectJSONLD(RAW);        // â‘¢ è‡ªå‹•ç”¢ç”Ÿ JSON-LD çµæ§‹åŒ–è³‡æ–™
        apply();
      }catch(err){
        statusEl.textContent = "è®€å–å¤±æ•—ï¼š" + err.message;
      }
    }

    // æ­£è¦åŒ–
    function normalize(list){
      for(const it of list){
        it.title = (it.title||"").toString();
        it.city = (it.city||"").toString();
        it.province = (it.province||"").toString();
        it.kind = (it.kind||"").toString();
        it.tags = Array.isArray(it.tags)? it.tags : (it.tags? it.tags.toString().split(",").map(s=>s.trim()).filter(Boolean):[]);
        it.image = (it.image||"").toString();
        it.link = (it.link||"").toString();
        it.excerpt = (it.excerpt||"").toString();
        it.content = (it.content||"").toString();
        it.created = it.created ? new Date(it.created) : new Date(0);
      }
    }

    // ä¸‹æ‹‰èˆ‡ Tags
    function buildFacetOptions(list){
      const cities = [...new Set(list.map(x=>x.city).filter(Boolean))].sort();
      const provs = [...new Set(list.map(x=>x.province).filter(Boolean))].sort();
      fillSelect(citySel, ["å…¨éƒ¨åŸå¸‚", ...cities], ["", ...cities]);
      fillSelect(provSel, ["å…¨éƒ¨çœä»½", ...provs], ["", ...provs]);
    }
    function fillSelect(sel, labels, values){
      sel.innerHTML = "";
      labels.forEach((lbl,i)=>{
        const opt = document.createElement('option');
        opt.textContent = lbl; opt.value = values[i];
        sel.appendChild(opt);
      });
    }
    function buildTagChips(list){
      TAGS = new Set();
      list.forEach(x => (x.tags||[]).forEach(t=>TAGS.add(t)));
      tagChips.innerHTML = "";
      const allChip = chipEl("å…¨éƒ¨æ¨™ç±¤","");
      allChip.classList.add('active');
      tagChips.appendChild(allChip);
      [...TAGS].sort().forEach(t=> tagChips.appendChild(chipEl(t,t)));
    }
    function chipEl(text,value){
      const b = document.createElement('button');
      b.type="button"; b.className="chip"; b.textContent=text; b.dataset.value=value;
      b.addEventListener('click', ()=>{
        [...tagChips.querySelectorAll('.chip')].forEach(c=>c.classList.remove('active'));
        b.classList.add('active');
        ACTIVE_TAG = value; apply();
      });
      return b;
    }

    // æœ€æ–°ç¾é£Ÿåˆ†äº«ï¼ˆå–æœ€æ–° 6 ç­†ã€kind=ç¾é£Ÿ å„ªå…ˆï¼‰
    function renderLatest(list){
      const latest = list.slice().sort((a,b)=>b.created-a.created)
        .filter(x=>x.kind==="ç¾é£Ÿ")
        .slice(0,6);
      latestWrap.innerHTML = latest.map(x=>`
        <article class="latest-card">
          <div class="latest-thumb">
            ${x.image ? `<img src="${escapeAttr(x.image)}" alt="${escapeAttr(x.title)}" loading="lazy">` : `<div style="font-size:12px;color:#6b7280">No image</div>`}
          </div>
          <div class="latest-body">
            <div class="latest-title">${escapeHTML(x.title)}</div>
            <div class="latest-meta">${x.city?escapeHTML(x.city):""} ${x.province?(" Â· "+escapeHTML(x.province)):""}</div>
          </div>
        </article>
      `).join('');
    }

    // ä¸»æ¸…å–®ï¼šç¯©é¸ + æ’åº + æ¸²æŸ“
    function apply(){
      const term = q.value.trim().toLowerCase();
      const city = citySel.value, prov = provSel.value, kind = kindSel.value, sort = sortSel.value;

      let list = RAW.slice();
      if(city) list = list.filter(x=>x.city===city);
      if(prov) list = list.filter(x=>x.province===prov);
      if(kind) list = list.filter(x=>x.kind===kind);
      if(ACTIVE_TAG) list = list.filter(x=>(x.tags||[]).includes(ACTIVE_TAG));
      if(term){
        list = list.filter(x=>{
          const hay = [x.title,x.excerpt,x.content,x.city,x.province,x.kind,...(x.tags||[])].join(" ").toLowerCase();
          return hay.includes(term);
        });
      }
      if(sort==="new") list.sort((a,b)=>b.created-a.created);
      if(sort==="az") list.sort((a,b)=>a.title.localeCompare(b.title,'zh-Hant'));

      render(list);
    }

    function render(items){
      if(!items.length){
        grid.hidden=true; statusEl.hidden=false; statusEl.className="empty";
        statusEl.textContent="æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„å…§å®¹ã€‚èª¿æ•´ç¯©é¸æˆ–å†è©¦æœå°‹é—œéµå­—ã€‚"; return;
      }
      grid.innerHTML = items.map(x=>cardHTML(x)).join('');
      statusEl.hidden=true; grid.hidden=false;
    }

    // â‘£ å¡ç‰‡å«ã€Œä½œè€…ç°¡ä»‹ï¼‹ç‰ˆæ¬Šã€èˆ‡ã€Œæ¬Šå¨é€£çµã€
    function cardHTML(x){
      const dateStr = x.created instanceof Date && !isNaN(x.created) ? x.created.toLocaleDateString() : "";
      const tags = (x.tags||[]).map(t=>`<span class="tag">${escapeHTML(t)}</span>`).join('');
      const img = x.image ? `<img src="${escapeAttr(x.image)}" alt="${escapeAttr(x.title)}" loading="lazy">` : `<div style="font-size:12px;color:#6b7280">No image</div>`;
      const linkBtn = x.link ? `<a class="btn primary" href="${escapeAttr(x.link)}" target="_blank" rel="noopener">æŸ¥çœ‹è©³æƒ…</a>` : "";
      const authority = buildAuthorityLink(x); // å¤–éƒ¨æ¬Šå¨é€£çµ
      return `
        <article class="card" itemscope itemtype="https://schema.org/BlogPosting">
          <div class="thumb">${img}</div>
          <div class="card-body">
            <h3 class="title" itemprop="headline">${escapeHTML(x.title)}</h3>
            <div class="meta">
              ${x.city?`<span itemprop="contentLocation">${escapeHTML(x.city)}</span>`:""}
              ${x.province?`ã€€<span>${escapeHTML(x.province)}</span>`:""}
              ${x.kind?`ã€€<span class="badge">${escapeHTML(x.kind)}</span>`:""}
              ${dateStr?`ã€€<span itemprop="datePublished" content="${x.created.toISOString()}">${dateStr}</span>`:""}
            </div>
            ${x.excerpt?`<p class="excerpt" itemprop="description">${escapeHTML(x.excerpt)}</p>`:""}
            ${tags?`<div class="tags" aria-label="æ¨™ç±¤">${tags}</div>`:""}
            <p class="bio">ä½œè€…ï¼šHillï½œåŸå‰µå¯¦æ‹èˆ‡åœ¨åœ°é«”é©—ç­†è¨˜ã€‚æœªç¶“æˆæ¬Šè«‹å‹¿è½‰è¼‰ï¼ˆÂ© Todayâ€™s Tasksï¼‰ã€‚</p>
          </div>
          <div class="actions">
            ${linkBtn}
            ${authority}
            <a class="btn" href="#top" onclick="window.scrollTo({top:0,behavior:'smooth'})">å›åˆ°ä¸Šæ–¹</a>
          </div>
        </article>
      `;
    }

    // æ¬Šå¨é€£çµï¼ˆä¾é¡åˆ¥ç”¢ç”Ÿæœå°‹é€£çµï¼‰
    function buildAuthorityLink(x){
      const q = encodeURIComponent((x.city?x.city+" ":"") + x.title);
      if(x.kind==="ç¾é£Ÿ"){
        const url = `https://www.dianping.com/search/keyword/2/0_${q}`;
        return `<a class="btn" href="${url}" target="_blank" rel="nofollow noopener">æ¬Šå¨é€£çµï¼šå¤§çœ¾é»è©•</a>`;
      }else{
        const url = `https://www.tripadvisor.com/Search?q=${q}`;
        return `<a class="btn" href="${url}" target="_blank" rel="nofollow noopener">æ¬Šå¨é€£çµï¼šTripAdvisor</a>`;
      }
    }

    // â‘¢ è‡ªå‹•æ³¨å…¥ JSON-LDï¼ˆå¾è©¦ç®—è¡¨é¤µå…¥ï¼Œç„¡é ˆæ‰‹å¯«ï¼‰
    function injectJSONLD(list){
      // åªå–å‰ 10 ç­†é¿å…éå¤§
      const top = list.slice().sort((a,b)=>b.created-a.created).slice(0,10);
      const itemList = {
        "@context": "https://schema.org",
        "@type": "ItemList",
        "itemListElement": top.map((it, i)=>({
          "@type":"ListItem",
          "position": i+1,
          "url": it.link || "https://todays-tasks.com/china-explore.html"
        }))
      };
      const posts = top.map(it => ({
        "@context":"https://schema.org",
        "@type":"BlogPosting",
        "headline": it.title || "",
        "image": it.image ? [it.image] : undefined,
        "datePublished": it.created? new Date(it.created).toISOString() : undefined,
        "author": { "@type":"Person","name":"Hill" },
        "publisher": { "@type":"Organization","name":"Today's Tasks" },
        "articleSection": it.kind || "",
        "description": it.excerpt || "",
        "mainEntityOfPage": it.link || "https://todays-tasks.com/china-explore.html"
      }));

      // å…ˆç§»é™¤èˆŠçš„å‹•æ…‹ JSON-LD
      document.querySelectorAll('script[data-dynamic-jsonld="1"]').forEach(n=>n.remove());

      // æ’å…¥ ItemList
      addJsonLd(itemList);
      // æ’å…¥æ¯ç¯‡ BlogPosting
      posts.forEach(p=>addJsonLd(p));
    }
    function addJsonLd(obj){
      const s = document.createElement('script');
      s.type = "application/ld+json";
      s.dataset.dynamicJsonld = "1";
      s.textContent = JSON.stringify(obj);
      document.head.appendChild(s);
    }

    // å·¥å…·
    function escapeHTML(s){return (s||"").replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]))}
    function escapeAttr(s){return escapeHTML(s)}
  </script>
</body>
</html>
