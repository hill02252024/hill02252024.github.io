<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ä¸­åœ‹ç¾é£Ÿç¾æ™¯åˆ†äº«ï½œChina Explore</title>
  <meta name="description" content="ä¸­åœ‹å…§åœ°æ—…è¡Œçš„ç¾é£Ÿèˆ‡ç¾æ™¯åˆ†äº«ã€‚ä¾åŸå¸‚ã€é¡åˆ¥èˆ‡æ¨™ç±¤ç€è¦½ï¼Œæ”¯æ´æœå°‹ã€æ’åºèˆ‡åˆ†é ã€‚åœ–ç‰‡ä¸è£åˆ‡è‡ªé©æ‡‰é¡¯ç¤ºã€‚"/>
  <meta name="robots" content="index,follow,max-image-preview:large"/>

  <!-- Canonicalï¼šé¦–é ä¸»ç‰ˆæœ¬ -->
  <link rel="canonical" href="https://todays-tasks.com/"/>

  <!-- Open Graph / Twitter -->
  <meta property="og:locale" content="zh_TW">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Today's Tasks">
  <meta property="og:title" content="ä¸­åœ‹ç¾é£Ÿç¾æ™¯åˆ†äº«ï½œChina Explore">
  <meta property="og:description" content="ä¸­åœ‹å…§åœ°æ—…è¡Œçš„ç¾é£Ÿèˆ‡ç¾æ™¯åˆ†äº«ã€‚ä¾åŸå¸‚ã€é¡åˆ¥èˆ‡æ¨™ç±¤ç€è¦½ï¼Œæ”¯æ´æœå°‹ã€æ’åºèˆ‡åˆ†é ã€‚">
  <meta property="og:url" content="https://todays-tasks.com/">
  <meta property="og:image" content="https://todays-tasks.com/assets/cover.jpg">
  <meta name="twitter:card" content="summary_large_image">

  <link rel="stylesheet" href="/style.css"/>

  <style>
    /* ä½ çš„åŸæ¨£å¼ï¼ˆç•¥ï¼‰â€” ä¿ç•™ */
    .page-wrap{max-width:1080px;margin:24px auto;padding:0 16px}
    .h1{font-size:28px;margin:6px 0 4px}
    .lede{color:#4b5563;margin-bottom:14px}
    .latest{margin:18px 0 8px}
    .latest h2{font-size:20px;margin:0 0 10px}
    .latest-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    @media(max-width:980px){.latest-grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:640px){.latest-grid{grid-template-columns:1fr}}
    .latest-card{border:1px solid #e5e7eb;border-radius:10px;background:#fff;overflow:hidden;text-decoration:none;color:inherit;display:block}
    .latest-thumb{aspect-ratio:16/10;background:#f8fafc;display:flex;align-items:center;justify-content:center}
    .latest-thumb img{width:100%;height:100%;object-fit:contain;display:block}
    .latest-body{padding:10px}
    .latest-title{font-weight:700;line-height:1.35;margin:0 0 4px;font-size:15px}
    .latest-meta{font-size:12px;color:#6b7280}
    .toolbar{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin:16px 0 12px}
    .toolbar input[type="search"], .toolbar select{padding:10px 12px;border:1px solid #d1d5db;border-radius:8px}
    .toolbar input[type="search"]{flex:1;min-width:240px}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0 16px}
    .chip{border:1px solid #d1d5db;border-radius:999px;padding:6px 12px;font-size:14px;color:#1f2937;background:#fff;cursor:pointer;user-select:none}
    .chip.active{background:#2563eb;color:#fff;border-color:#2563eb}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    @media(max-width:980px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:640px){.grid{grid-template-columns:1fr}}
    .card{border:1px solid #e5e7eb;border-radius:12px;background:#fff;overflow:hidden;display:flex;flex-direction:column}
    .thumb{aspect-ratio:16/10;background:#f8fafc;display:flex;align-items:center;justify-content:center}
    .thumb img{width:100%;height:100%;object-fit:contain;display:block}
    .card-body{padding:12px}
    .title{font-weight:700;line-height:1.35;margin:2px 0 6px}
    .meta{font-size:12px;color:#6b7280;margin-bottom:8px}
    .badge{display:inline-block;margin-left:6px;padding:2px 8px;border-radius:999px;background:#e5f2ff;color:#2563eb;font-size:12px;border:1px solid #bfdbfe}
    .tags{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
    .tag{font-size:12px;padding:2px 8px;border-radius:999px;background:#f3f4f6;color:#374151}
    .excerpt{font-size:13px;color:#374151;margin:6px 0 0}
    .bio{margin:8px 0 0;font-size:12px;color:#6b7280}
    .actions{display:flex;gap:8px;margin-top:auto;padding:12px;border-top:1px solid #f3f4f6;background:#fafafa}
    .btn{display:inline-block;text-align:center;padding:10px 12px;border-radius:8px;border:1px solid #d1d5db;background:#fff;color:#111827;text-decoration:none}
    .btn.primary{background:#111827;color:#fff;border-color:#111827}
    .pager{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;margin:18px 0}
    .pager button{min-width:40px;padding:8px 10px;border:1px solid #d1d5db;background:#fff;border-radius:8px;cursor:pointer}
    .pager button[disabled]{opacity:.5;cursor:not-allowed}
    .pager .active{background:#111827;color:#fff;border-color:#111827}
    .empty,.loading{padding:24px;border:1px dashed #cbd5e1;border-radius:12px;color:#475569;background:#f8fafc;margin:12px 0}
    .chips-compact-wrap{position:relative;margin:10px 0 16px}
    .chips-scroll{display:flex;gap:8px;overflow-x:auto;padding-right:48px;scrollbar-width:none;-ms-overflow-style:none;white-space:nowrap}
    .chips-scroll::-webkit-scrollbar{display:none}
    .chips-fade::after{content:"";position:absolute;right:52px;top:0;height:100%;width:48px;pointer-events:none;background:linear-gradient(90deg, rgba(255,255,255,0) 0%, #ffffff 80%)}
    .chips-more-btn{position:absolute;right:0;top:50%;transform:translateY(-50%);border:1px solid #d1d5db;background:#fff;border-radius:8px;padding:8px 10px;font-size:14px;cursor:pointer}
    .modal-backdrop{position:fixed;inset:0;background:rgba(15,23,42,.5);display:none;align-items:center;justify-content:center;z-index:50}
    .modal{width:min(720px, 92vw);background:#fff;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.2);padding:16px}
    .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    .modal-title{font-size:18px;font-weight:700}
    .modal-close{border:1px solid #d1d5db;background:#fff;border-radius:8px;padding:6px 10px;cursor:pointer}
    .modal-search{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:8px;margin-bottom:10px}
    .modal-tags{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;max-height:48vh;overflow:auto}
    @media(max-width:720px){.modal-tags{grid-template-columns:repeat(2,1fr)}}
    .modal-tag{border:1px solid #d1d5db;border-radius:10px;padding:8px 10px;font-size:14px;cursor:pointer;background:#fff}
    .modal-tag.active{background:#2563eb;color:#fff;border-color:#2563eb}
  </style>

  <!-- çµ„ç¹” + ç«™å…§æœå°‹ï¼ˆæå‡å“ç‰Œ/AdSenseä¿¡ä»»ï¼‰ -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Organization",
    "name":"Today's Tasks",
    "url":"https://todays-tasks.com",
    "logo":"https://todays-tasks.com/assets/logo.png"
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebSite",
    "url":"https://todays-tasks.com/",
    "name":"Today's Tasks",
    "potentialAction":{
      "@type":"SearchAction",
      "target":"https://todays-tasks.com/?q={search_term_string}",
      "query-input":"required name=search_term_string"
    }
  }
  </script>

  <!-- éºµåŒ…å±‘ JSON-LDï¼ˆé¦–é  + å°ˆæ¬„ï¼‰ -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://todays-tasks.com/"},
      {"@type":"ListItem","position":2,"name":"China Explore","item":"https://todays-tasks.com/china-explore.html"}
    ]
  }
  </script>
</head>
<body>
  <!-- å°è¦½åˆ— -->
  <nav class="compliance-links" aria-label="Primary">
    <a href="/index.html">Home</a> |
    <a href="/about.html">About</a> |
    <a href="/contact.html">Contact</a> |
    <a href="/privacy.html">Privacy Policy</a> |
    <a href="/productivity-tips.html">Productivity Tips</a> |
    <a href="/article2.html">Time Management</a> |
    <a href="/article3.html">Digital To-Do Lists</a> |
    <a href="/article4.html">How to Use</a> |
    <a href="/article5.html">Weekly Review</a> |
    <a href="/etsy-guides.html">Time-Saving</a> |
    <a href="/todo.html">To Do List</a>
  </nav>

  <main class="page-wrap">
    <h1 class="h1">ä¸­åœ‹ç¾é£Ÿç¾æ™¯åˆ†äº«ï¼ˆChina Exploreï¼‰</h1>
    <p class="lede">å³æ™‚å¾ Google è©¦ç®—è¡¨åŒæ­¥å…§å®¹ï¼šæ”¯æ´æœå°‹ã€ç¯©é¸ã€æ’åºèˆ‡åˆ†é ï¼›åœ–ç‰‡ä»¥ã€Œä¸è£åˆ‡ã€æ¨¡å¼è‡ªé©æ‡‰é¡¯ç¤ºã€‚</p>

    <!-- æœ€æ–° -->
    <section class="latest" aria-label="æœ€æ–°ç¾é£Ÿåˆ†äº«">
      <h2>ğŸœ æœ€æ–°ç¾é£Ÿåˆ†äº«</h2>
      <div id="latest" class="latest-grid"></div>
    </section>

    <!-- å·¥å…·åˆ— -->
    <div class="toolbar" aria-label="Filters">
      <input id="q" type="search" placeholder="æœå°‹æ¨™é¡Œï¼æ‘˜è¦ï¼å…§æ–‡ï¼æ¨™ç±¤â€¦" aria-label="æœå°‹"/>
      <select id="citySel" aria-label="åŸå¸‚"><option value="">å…¨éƒ¨åŸå¸‚</option></select>
      <select id="provSel" aria-label="çœä»½"><option value="">å…¨éƒ¨çœä»½</option></select>
      <select id="kindSel" aria-label="é¡åˆ¥">
        <option value="">å…¨éƒ¨é¡åˆ¥</option>
        <option value="ç¾é£Ÿ">ç¾é£Ÿ</option>
        <option value="ç¾æ™¯">ç¾æ™¯</option>
      </select>
      <select id="sortSel" aria-label="æ’åº">
        <option value="new">æ’åºï¼šæœ€æ–°</option>
        <option value="az">æ’åºï¼šAâ†’Z</option>
      </select>
      <button id="refreshBtn" class="btn" type="button" title="é‡æ–°æŠ“å–è³‡æ–™">Refresh</button>
    </div>

    <!-- æ¨™ç±¤ -->
    <div class="chips-compact-wrap chips-fade">
      <div id="tagChips" class="chips-scroll" aria-label="Tags å¿«é€Ÿç¯©é¸"></div>
      <button id="moreTagsBtn" class="chips-more-btn" type="button" title="æ›´å¤šæ¨™ç±¤">+0</button>
    </div>

    <!-- æ›´å¤šæ¨™ç±¤å½ˆçª— -->
    <div id="tagModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="tagModalTitle">
      <div class="modal">
        <div class="modal-header">
          <div id="tagModalTitle" class="modal-title">é¸æ“‡æ¨™ç±¤</div>
          <button class="modal-close" type="button" id="tagModalClose">é—œé–‰</button>
        </div>
        <input id="tagSearch" class="modal-search" placeholder="æœå°‹æ¨™ç±¤â€¦" aria-label="æœå°‹æ¨™ç±¤"/>
        <div id="tagAll" class="modal-tags" aria-label="æ‰€æœ‰æ¨™ç±¤"></div>
      </div>
    </div>

    <!-- ä¸»æ¸…å–® + åˆ†é  -->
    <div id="status" class="loading" role="status">è¼‰å…¥ä¸­â€¦</div>
    <div id="grid" class="grid" aria-live="polite" hidden></div>
    <nav id="pager" class="pager" aria-label="åˆ†é " hidden></nav>
  </main>

  <footer class="footer">Â© 2025 Todayâ€™s Tasks. All rights reserved.</footer>

  <script>
    /* ===== è¨­å®š ===== */
    const FEED_URL  = "https://script.google.com/macros/s/AKfycbwq5InzCeyUnW-GHe6bNqReMQMzWvwKe_pAZpD7ONHZ4LZrBdt8lgtpdxu1c57AaPx3ww/exec";
    const PAGE_SIZE = 10;
    const MAX_INLINE_TAGS = 12;

    /* ===== DOM ===== */
    const q = document.getElementById('q');
    const citySel = document.getElementById('citySel');
    const provSel = document.getElementById('provSel');
    const kindSel = document.getElementById('kindSel');
    const sortSel = document.getElementById('sortSel');
    const refreshBtn = document.getElementById('refreshBtn');
    const tagChips = document.getElementById('tagChips');
    const moreTagsBtn = document.getElementById('moreTagsBtn');
    const tagModal = document.getElementById('tagModal');
    const tagModalClose = document.getElementById('tagModalClose');
    const tagSearch = document.getElementById('tagSearch');
    const tagAll = document.getElementById('tagAll');
    const statusEl = document.getElementById('status');
    const grid = document.getElementById('grid');
    const latestWrap = document.getElementById('latest');
    const pager = document.getElementById('pager');

    /* ===== ç‹€æ…‹ ===== */
    let RAW = [];
    let FILTERED = [];
    let ACTIVE_TAG = "";
    let TAGS = new Set();
    let curPage = getPageFromHash() || 1;

    /* ===== å•Ÿå‹• ===== */
    attachEvents();
    fetchFeed();

    function attachEvents(){
      q.addEventListener('input', ()=>{ curPage=1; apply(); });
      citySel.addEventListener('change', ()=>{ curPage=1; apply(); });
      provSel.addEventListener('change', ()=>{ curPage=1; apply(); });
      kindSel.addEventListener('change', ()=>{ curPage=1; apply(); });
      sortSel.addEventListener('change', ()=>{ curPage=1; apply(); });
      refreshBtn.addEventListener('click', ()=>fetchFeed(true));
      window.addEventListener('hashchange', ()=>{
        const p = getPageFromHash();
        if(p && p!==curPage){ curPage=p; renderPaged(); }
      });
    }

    async function fetchFeed(noCache=false){
      try{
        statusEl.hidden = false; statusEl.textContent = "è¼‰å…¥ä¸­â€¦"; grid.hidden = true; pager.hidden = true;
        const url = noCache ? FEED_URL + (FEED_URL.includes('?')?'&':'?') + 't=' + Date.now() : FEED_URL;
        const res = await fetch(url, {cache: noCache ? 'no-store' : 'default'});
        if(!res.ok) throw new Error('HTTP ' + res.status);
        const json = await res.json();

        RAW = Array.isArray(json.items) ? json.items : [];
        normalize(RAW);
        buildFacetOptions(RAW);
        buildTagChips(RAW);
        renderLatest(RAW);
        injectJSONLD(RAW);
        apply();
      }catch(err){
        statusEl.textContent = "è®€å–å¤±æ•—ï¼š" + err.message;
      }
    }

    function normalize(list){
      for(const it of list){
        it.id       = _toSafeString(it.id);
        it.title    = _toSafeString(it.title);
        it.city     = _toSafeString(it.city);
        it.province = _toSafeString(it.province);
        it.kind     = _toSafeString(it.kind);

        if (Array.isArray(it.tags)) {
          it.tags = it.tags.map(_toSafeString).map(s=>s.trim()).filter(Boolean);
        } else {
          const raw = _toSafeString(it.tags);
          it.tags = raw ? raw.split(",").map(s=>s.trim()).filter(Boolean) : [];
        }

        it.image   = _toSafeString(it.image);
        it.link    = _toSafeString(it.link);
        it.excerpt = _toSafeString(it.excerpt);
        it.content = _toSafeString(it.content);
        it.created = it.created ? new Date(it.created) : new Date(0);
      }
    }

    function buildFacetOptions(list){
      const cities = [...new Set(list.map(x=>x.city).filter(Boolean))].sort();
      const provs  = [...new Set(list.map(x=>x.province).filter(Boolean))].sort();
      fillSelect(citySel, ["å…¨éƒ¨åŸå¸‚", ...cities], ["", ...cities]);
      fillSelect(provSel, ["å…¨éƒ¨çœä»½", ...provs],  ["", ...provs ]);
    }
    function fillSelect(sel, labels, values){
      sel.innerHTML = "";
      labels.forEach((lbl,i)=>{
        const opt = document.createElement('option');
        opt.textContent = lbl; opt.value = values[i];
        sel.appendChild(opt);
      });
    }

    function buildTagChips(list){
      const count = new Map();
      list.forEach(x => (x.tags||[]).forEach(t=> count.set(t, (count.get(t)||0)+1)));
      const sorted = [...count.entries()].sort((a,b)=> b[1]-a[1]).map(([t])=>t);
      TAGS = new Set(sorted);
      const allTags = ["", ...sorted];

      tagChips.innerHTML = "";
      const inline = allTags.slice(0, MAX_INLINE_TAGS);
      inline.forEach(v => tagChips.appendChild(chipInlineEl(v)));

      const remaining = Math.max(0, allTags.length - inline.length);
      moreTagsBtn.textContent = remaining > 0 ? `+${remaining}` : "+0";
      moreTagsBtn.disabled = remaining === 0;

      renderModalTags(allTags);

      moreTagsBtn.onclick = () => openTagModal();
      tagModalClose.onclick = () => closeTagModal();
      tagModal.addEventListener('click', (e)=>{ if(e.target === tagModal) closeTagModal(); });
      tagSearch.addEventListener('input', ()=> filterModalTags());
    }

    function chipInlineEl(value){
      const label = value ? value : "å…¨éƒ¨æ¨™ç±¤";
      const b = document.createElement('button');
      b.type="button"; b.className="chip"; b.textContent=label; b.dataset.value=value;
      if ((ACTIVE_TAG||"") === value) b.classList.add('active');
      b.addEventListener('click', ()=> selectTag(value, false));
      return b;
    }

    function renderModalTags(allTags){
      tagAll.innerHTML = "";
      allTags.forEach(v=>{
        const btn = document.createElement('button');
        btn.type = "button";
        btn.className = "modal-tag";
        btn.textContent = v ? v : "å…¨éƒ¨æ¨™ç±¤";
        btn.dataset.value = v;
        if ((ACTIVE_TAG||"") === v) btn.classList.add('active');
        btn.addEventListener('click', ()=> selectTag(v, true));
        tagAll.appendChild(btn);
      });
    }

    function filterModalTags(){
      const kw = tagSearch.value.trim().toLowerCase();
      [...tagAll.children].forEach(btn=>{
        const t = btn.textContent.toLowerCase();
        btn.style.display = (!kw || t.includes(kw)) ? "" : "none";
      });
    }

    function openTagModal(){ tagModal.style.display = "flex"; tagSearch.value = ""; filterModalTags(); setTimeout(()=> tagSearch.focus(), 0); }
    function closeTagModal(){ tagModal.style.display = "none"; }

    function selectTag(value, fromModal){
      ACTIVE_TAG = value || "";
      [...tagChips.querySelectorAll('.chip')].forEach(c=> c.classList.toggle('active', (c.dataset.value||"") === ACTIVE_TAG));
      [...tagAll.querySelectorAll('.modal-tag')].forEach(c=> c.classList.toggle('active', (c.dataset.value||"") === ACTIVE_TAG));
      curPage = 1; apply();
      if (fromModal) closeTagModal();
    }

    function renderLatest(list){
      const latest = list.slice().sort((a,b)=>b.created-a.created)
        .filter(x=>x.kind==="ç¾é£Ÿ").slice(0,6);
      latestWrap.innerHTML = latest.map(x=>`
        <a class="latest-card" href="/post.html?id=${escapeAttr(x.id)}" aria-label="${escapeAttr(x.title)}">
          <div class="latest-thumb">
            ${x.image ? `<img src="${escapeAttr(x.image)}" alt="${escapeAttr(x.title)}" loading="lazy">` : `<div style="font-size:12px;color:#6b7280">No image</div>`}
          </div>
          <div class="latest-body">
            <div class="latest-title">${escapeHTML(x.title)}</div>
            <div class="latest-meta">${x.city?escapeHTML(x.city):""} ${x.province?(" Â· "+escapeHTML(x.province)):""}</div>
          </div>
        </a>
      `).join('');
    }

    function apply(){
      const term = q.value.trim().toLowerCase();
      const city = citySel.value, prov = provSel.value, kind = kindSel.value, sort = sortSel.value;

      let list = RAW.slice();
      if(city) list = list.filter(x=>x.city===city);
      if(prov) list = list.filter(x=>x.province===prov);
      if(kind) list = list.filter(x=>x.kind===kind);
      if(ACTIVE_TAG) list = list.filter(x=>(x.tags||[]).includes(ACTIVE_TAG));
      if(term){
        list = list.filter(x=>{
          const hay = [x.title,x.excerpt,x.content,x.city,x.province,x.kind,...(x.tags||[])].join(" ").toLowerCase();
          return hay.includes(term);
        });
      }
      if(sort==="new") list.sort((a,b)=>b.created-a.created);
      if(sort==="az")  list.sort((a,b)=>a.title.localeCompare(b.title,'zh-Hant'));

      FILTERED = list;
      const totalPages = Math.max(1, Math.ceil(FILTERED.length / PAGE_SIZE));
      if(curPage>totalPages) curPage=1;

      renderPaged();
    }

    function renderPaged(){
      if(!FILTERED.length){
        grid.hidden=true; pager.hidden=true; statusEl.hidden=false; statusEl.className="empty";
        statusEl.textContent="æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„å…§å®¹ã€‚èª¿æ•´ç¯©é¸æˆ–å†è©¦æœå°‹é—œéµå­—ã€‚"; return;
      }
      const totalPages = Math.max(1, Math.ceil(FILTERED.length / PAGE_SIZE));
      const start = (curPage-1)*PAGE_SIZE;
      const pageItems = FILTERED.slice(start, start+PAGE_SIZE);

      grid.innerHTML = pageItems.map(x=>cardHTML(x)).join('');
      statusEl.hidden=true; grid.hidden=false;

      renderPager(totalPages);
      setPageHash(curPage);

      // åˆ†é  relï¼ˆè®“ Google çŸ¥é“ä¸Šä¸‹é ï¼‰
      const head = document.getElementsByTagName('head')[0];
      [...document.querySelectorAll('link[rel="prev"],link[rel="next"]')].forEach(n=>n.remove());
      const base = location.origin + location.pathname;
      if(curPage>1){ const l=document.createElement('link'); l.rel='prev'; l.href=`${base}#p=${curPage-1}`; head.appendChild(l); }
      const totalPages2 = Math.max(1, Math.ceil(FILTERED.length / PAGE_SIZE));
      if(curPage<totalPages2){ const l=document.createElement('link'); l.rel='next'; l.href=`${base}#p=${curPage+1}`; head.appendChild(l); }

      window.scrollTo({ top: grid.offsetTop - 80, behavior:'smooth' });
    }

    function renderPager(totalPages){
      pager.hidden = false;
      const btn = (label, disabled, go, active=false)=>{
        return `<button ${disabled?'disabled':''} class="${active?'active':''}" aria-current="${active?'page':'false'}" onclick="${disabled?'':go}">${label}</button>`;
      };
      let html = "";
      html += btn('Â«', curPage===1, 'goPage(1)');
      html += btn('â€¹', curPage===1, `goPage(${curPage-1})`);

      const span = 2;
      const from = Math.max(1, curPage-span);
      const to   = Math.min(totalPages, curPage+span);
      for(let i=from;i<=to;i++){
        html += btn(i, false, `goPage(${i})`, i===curPage);
      }

      html += btn('â€º', curPage===totalPages, `goPage(${curPage+1})`);
      html += btn('Â»', curPage===totalPages, `goPage(${totalPages})`);
      pager.innerHTML = html;
    }

    function goPage(n){
      const totalPages = Math.max(1, Math.ceil(FILTERED.length / PAGE_SIZE));
      curPage = Math.min(Math.max(1,n), totalPages);
      renderPaged();
    }
    function setPageHash(p){ location.hash = 'p=' + p; }
    function getPageFromHash(){ const m = location.hash.match(/p=(\d+)/); return m ? parseInt(m[1],10) : null; }

    function cardHTML(x){
      const dateStr = x.created instanceof Date && !isNaN(x.created) ? x.created.toLocaleDateString() : "";
      const tags = (x.tags||[]).map(t=>`<span class="tag">${escapeHTML(t)}</span>`).join('');
      const img = x.image ? `<img src="${escapeAttr(x.image)}" alt="${escapeAttr(x.title)}" loading="lazy">` : `<div style="font-size:12px;color:#6b7280">No image</div>`;
      const detailUrl = `/post.html?id=${escapeAttr(x.id)}`;
      const authority = buildAuthorityLink(x);
      return `
        <article class="card" itemscope itemtype="https://schema.org/BlogPosting">
          <a class="thumb" href="${detailUrl}" aria-label="${escapeAttr(x.title)}">${img}</a>
          <div class="card-body">
            <h3 class="title" itemprop="headline"><a href="${detailUrl}" style="text-decoration:none;color:inherit">${escapeHTML(x.title)}</a></h3>
            <div class="meta">
              ${x.city?`<span itemprop="contentLocation">${escapeHTML(x.city)}</span>`:""}
              ${x.province?`ã€€<span>${escapeHTML(x.province)}</span>`:""}
              ${x.kind?`ã€€<span class="badge">${escapeHTML(x.kind)}</span>`:""}
              ${dateStr?`ã€€<span itemprop="datePublished" content="${x.created.toISOString()}">${dateStr}</span>`:""}
            </div>
            ${x.excerpt?`<p class="excerpt" itemprop="description">${escapeHTML(x.excerpt)}</p>`:""}
            ${tags?`<div class="tags" aria-label="æ¨™ç±¤">${tags}</div>`:""}
            <p class="bio">ä½œè€…ï¼šHillï½œåŸå‰µå¯¦æ‹èˆ‡åœ¨åœ°é«”é©—ç­†è¨˜ã€‚æœªç¶“æˆæ¬Šè«‹å‹¿è½‰è¼‰ï¼ˆÂ© Todayâ€™s Tasksï¼‰ã€‚</p>
          </div>
          <div class="actions">
            <a class="btn primary" href="${detailUrl}">æŸ¥çœ‹è©³æƒ…</a>
            ${authority}
            <a class="btn" href="#top" onclick="window.scrollTo({top:0,behavior:'smooth'})">å›åˆ°ä¸Šæ–¹</a>
          </div>
        </article>
      `;
    }

    function buildAuthorityLink(x){
      const q = encodeURIComponent((x.city?x.city+" ":"") + x.title);
      if(x.kind==="ç¾é£Ÿ"){
        const url = `https://www.dianping.com/search/keyword/2/0_${q}`;
        return `<a class="btn" href="${url}" target="_blank" rel="nofollow noopener">æ¬Šå¨é€£çµï¼šå¤§çœ¾é»è©•</a>`;
      }else{
        const url = `https://www.tripadvisor.com/Search?q=${q}`;
        return `<a class="btn" href="${url}" target="_blank" rel="nofollow noopener">æ¬Šå¨é€£çµï¼šTripAdvisor</a>`;
      }
    }

    /* ===== JSON-LDï¼ˆä½¿ç”¨çµ•å°ç¶²å€ï¼‰ ===== */
    function injectJSONLD(list){
      const top = list.slice().sort((a,b)=>b.created-a.created).slice(0,10);
      const itemList = {
        "@context": "https://schema.org",
        "@type": "ItemList",
        "itemListElement": top.map((it, i)=>({
          "@type":"ListItem",
          "position": i+1,
          "url": `https://todays-tasks.com/post.html?id=${encodeURIComponent(it.id)}`
        }))
      };
      const posts = top.map(it => ({
        "@context":"https://schema.org",
        "@type":"BlogPosting",
        "headline": it.title || "",
        "image": it.image ? [it.image] : undefined,
        "datePublished": it.created? new Date(it.created).toISOString() : undefined,
        "author": { "@type":"Person","name":"Hill" },
        "publisher": { "@type":"Organization","name":"Today's Tasks" },
        "articleSection": it.kind || "",
        "description": it.excerpt || "",
        "mainEntityOfPage": `https://todays-tasks.com/post.html?id=${encodeURIComponent(it.id)}`
      }));

      document.querySelectorAll('script[data-dynamic-jsonld="1"]').forEach(n=>n.remove());
      addJsonLd(itemList); posts.forEach(p=>addJsonLd(p));
    }
    function addJsonLd(obj){
      const s=document.createElement('script'); s.type="application/ld+json"; s.dataset.dynamicJsonld="1";
      s.textContent=JSON.stringify(obj); document.head.appendChild(s);
    }

    /* ===== å·¥å…· ===== */
    function _toSafeString(v){
      if (v == null) return "";
      if (typeof v === "string") return v;
      if (typeof v === "number" || typeof v === "boolean") return String(v);
      if (Array.isArray(v)) return v.join(",");
      try { return String(v); } catch { return ""; }
    }
    function escapeHTML(s){
      const str = _toSafeString(s);
      return str.replace(/[&<>"']/g, c => ({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));
    }
    function escapeAttr(s){ return escapeHTML(s); }
  </script>
</body>
</html>
